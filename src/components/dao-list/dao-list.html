<div class="dao-list-container">
  <!-- 列表工具栏 -->
  <div class="dao-list-toolbar">
    <!-- 工具栏主要按钮 -->
    <button class="dao-btn ghost has-icon"
      :class="{'pseudo-disabled': mainOperation.disabled}"
      @click="emit(mainOperation)">
      <svg class="icon" v-if="mainOperation.svg">
        <use xlink:href :href="`#icon_${mainOperation.svg}`"></use>
      </svg>
      <span class="text">{{mainOperation.name}}</span>
      <svg class="icon" v-if="mainOperation.disabled" v-dao-tooltip="mainOperation.disabledTooltip">
        <use xlink:href :href="`#icon_${mainOperation.disabledSvg}`"></use>
      </svg>
    </button>
    <!-- 工具栏按钮 -->
    <div class="dao-btn-group" v-for="operationGroup in operations">
      <button class="dao-btn ghost dao-icon"
        v-for="o in operationGroup.operations"
        :class="{'pseudo-disabled': o.disabled}"
        @click="emit(o)">
        <svg class="icon" v-if="o.svg">
          <use xlink:href :href="`#icon_${o.svg}`"></use>
        </svg>
        <svg class="icon" v-if="o.disabled" v-dao-tooltip="o.disabledTooltip">
          <use xlink:href :href="`#icon_${o.disabledSvg}`"></use>
        </svg>
      </button>
    </div>
    <div class="pull-right">
      <!-- 排序下拉菜单 -->
      <dao-dropdown
        trigger="click"
        :append-to-body="true"
        placement="bottom-end">
        <button class="dao-btn ghost has-icon">
          <svg class="icon">
            <use xlink:href :href="`#icon_sort-${sortingConfig.order}`"></use>
          </svg>
          <span class="text">{{columns[sortingConfig.sortBy].text}}</span>
          <svg class="icon">
            <use xlink:href="#icon_caret-down"></use>
          </svg>
        </button>
        <dao-dropdown-menu slot="list">
          <dao-dropdown-item v-for="c in columns" :key="c.name" @click="changeSortBy(c.name)">
            <svg class="icon" :class="{invisible: sortingConfig.sortBy !== c.name}">
              <use xlink:href="#icon_checkmark"></use>
            </svg>
            <span>{{c.text}}</span>
          </dao-dropdown-item>
          <dao-dropdown-item :is-divided="true"></dao-dropdown-item>
          <dao-dropdown-item @click="sortingConfig.order='asc'">
            <svg class="icon" :class="{invisible: sortingConfig.order !== 'asc'}">
              <use xlink:href="#icon_checkmark"></use>
            </svg>
            <span>升序</span>
          </dao-dropdown-item>
          <dao-dropdown-item @click="sortingConfig.order='desc'">
            <svg class="icon" :class="{invisible: sortingConfig.order !== 'desc'}">
              <use xlink:href="#icon_checkmark"></use>
            </svg>
            <span>降序</span>
          </dao-dropdown-item>
        </dao-dropdown-menu>
      </dao-dropdown>
      <!-- 显示设置菜单 -->
      <dao-dropdown
        trigger="click"
        :append-to-body="true"
        placement="bottom-end">
        <button class="dao-btn ghost dao-icon">
          <svg class="icon"><use xlink:href="#icon_setting"></use></svg>
          <svg class="icon"><use xlink:href="#icon_caret-down"></use></svg>
        </button>
        <dao-dropdown-menu slot="list">
          <dao-dropdown-item @click="refresh">刷新</dao-dropdown-item>
          <dao-dropdown-item @click="openSettingsDialog">查看显示选项</dao-dropdown-item>
          <dao-dropdown-item @click="openCustomToolbarDialog">自定义工具栏</dao-dropdown-item>
        </dao-dropdown-menu>
      </dao-dropdown>
    </div>
    <!-- 显示设置弹窗 -->
    <dao-list-settings-dialog
      :visible.sync="isSettingsDialogVisible"
      @confirm="onSettingsDialogConfirm"
      :columnsOrder="columnsOrder"
      :columns="columns">
    </dao-list-settings-dialog>
    <!-- 自定义工具栏弹窗 -->
    <dao-list-custom-toolbar-dialog
      :visible.sync="isCustomToolbarDialogVisible"
      @confirm="onCustomToolbarDialogConfirm">
    </dao-list-custom-toolbar-dialog>
  </div>
  <!-- 列表主要部分 -->
  <div class="dao-list-main">
    <!-- 列表的顶栏 -->
    <div class="dao-list-topbar">
      <filter-input class="dao-list-filter"
        :tableName="tableName"
        :rows="rows"
        :columns="columns"
        @change="onFilterInputChange"
        ></filter-input>
      <div class="dao-list-pagination">
        <span class="counts">共 {{allRowsNumber}} 个 {{tableName}}</span>
        <span class="counts" v-show="checkedRowsNumber > 0">
          ，已选中 {{checkedRowsNumber}} 个 {{tableName}}
        </span>
        <div class="pagination">
          <svg :class="{disabled: page === 0}" @click="prevPage">
            <use xlink:href="#icon_caret-left"></use>
          </svg>
          <span class="page" v-show="page > 2" @click="goToPage(0)">1</span><!--
       --><span class="page disabled" v-show="page > 2">...</span><!--
       --><span class="page" :class="{active: page == p}" v-for="p in pages" :key="p" @click="goToPage(p)">{{p + 1}}</span><!--
       --><span class="page disabled" v-show="page < pagesNumber - 3">...</span>
          <svg :class="{disabled: page === pagesNumber - 1}" @click="nextPage">
            <use xlink:href="#icon_caret-right"></use>
          </svg>
        </div>
      </div>
    </div>
    <!-- 列表主体 -->
    <div class="dao-list-scrolldiv">
      <table class="dao-list flexrow">
        <!-- 表头 -->
        <thead>
          <tr>
            <!-- 全选 -->
            <th class="checkbox">
              <input type="checkbox" class="round"
                :class="{'half-check': isAllChecked === 'partial'}"
                :checked="isAllChecked === 'yes'"
                @click.prevent="checkPage()">
              <check-all
                :currentRowsNumber="currentRowsNumber"
                :allRowsNumber="allRowsNumber"
                :checkedRowsNumber="checkedRowsNumber"
                @check-page="checkPage(true)"
                @check-all="checkAll(true)"
                @uncheck-all="checkAll(false)">
              </check-all>
            </th>
            <!-- th -->
            <dao-list-th v-for="c in columnsOrder"
              :key="c"
              @resize="onColumnResize(c, $event)"
              @click="changeSortBy(c)">
              <span>{{columns[c].text}}</span>
              <svg class="sort-arrow" v-if="sortingConfig.sortBy === c" v-show="sortingConfig.order === 'desc'">
                <use xlink:href="#icon_down-arrow"></use>
              </svg>
              <svg class="sort-arrow" v-if="sortingConfig.sortBy === c" v-show="sortingConfig.order === 'asc'">
                <use xlink:href="#icon_up-arrow"></use>
              </svg>
            </dao-list-th>
            <!-- 预留给操作的 th -->
            <th></th>
          </tr>
        </thead>
        <!-- 表身 -->
        <tbody>
          <tr :class="{checked: r.$checked}" v-for="r in currentRows" :key="r"
            @click="onRowClick(r, $event)"
            @contextmenu.prevent="onRowClick(r, $event)">
            <td class="checkbox">
              <input type="checkbox"
              class="round"
              :checked="r.$checked">
            </td>
            <template v-for="c in columnsOrder" :style="`width: ${columnsWidth[c]}`">
              <td :key="c" v-if="r[c].type === 'text'">{{r[c].text}}</td>
              <status-td :key="c"
                v-if="r[c].type === 'status'"
                :color="r[c].other.color"
                :text="r[c].text">
              </status-td>
              <custom-td v-if="r[c].type === 'custom'" :renderFunc="r[c].render" :td="r[c]"></custom-td>
            </template>
            <operation-td :row="r" :operations="operations"></operation-td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>